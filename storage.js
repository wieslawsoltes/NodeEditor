var s=(c,e,t)=>new Promise((r,n)=>{var o=l=>{try{a(t.next(l))}catch(u){n(u)}},i=l=>{try{a(t.throw(l))}catch(u){n(u)}},a=l=>l.done?r(l.value):Promise.resolve(l.value).then(o,i);a((t=t.apply(c,e)).next())}),S=(c,e,t)=>(e=c[Symbol.asyncIterator],t=(r,n)=>(n=c[r])&&(e[r]=o=>new Promise((i,a,l)=>(o=n.call(c,o),l=o.done,Promise.resolve(o.value).then(u=>i({value:u,done:l}),a)))),e?e.call(c):(c=c[Symbol.iterator](),e={},t("next"),t("return"),e));var y=class{constructor(e){this.database=e}openStore(e,t){return this.database.transaction(e,t).objectStore(e)}put(e,t,r){return s(this,null,function*(){let n=this.openStore(e,"readwrite");return yield new Promise((o,i)=>{let a=n.put(t,r);a.onsuccess=()=>{o(a.result)},a.onerror=()=>{i(a.error)}})})}get(e,t){let r=this.openStore(e,"readonly");return new Promise((n,o)=>{let i=r.get(t);i.onsuccess=()=>{n(i.result)},i.onerror=()=>{o(i.error)}})}delete(e,t){return s(this,null,function*(){let r=this.openStore(e,"readwrite");return yield new Promise((n,o)=>{let i=r.delete(t);i.onsuccess=()=>{n()},i.onerror=()=>{o(i.error)}})})}close(){this.database.close()}},g=class{constructor(e,t){this.databaseName=e;this.objectStores=t}connect(){return s(this,null,function*(){let e=window.indexedDB.open(this.databaseName,1);return e.onupgradeneeded=t=>{let r=t.target.result;this.objectStores.forEach(n=>{r.createObjectStore(n)})},yield new Promise((t,r)=>{e.onsuccess=n=>{t(new y(n.target.result))},e.onerror=n=>{r(n.target.error)}})})}},m="fileBookmarks",w=new g("AvaloniaDb",[m]);var d=class{constructor(e,t,r){this.handle=e;this.bookmarkId=t;this.wellKnownType=r}get name(){var e;return this.handle?this.handle.name:(e=this.wellKnownType)!=null?e:""}get kind(){return this.handle?this.handle.kind:"directory"}static createWellKnownDirectory(e){return new d(void 0,void 0,e)}static openRead(e){return s(this,null,function*(){if(!(e.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield e.verityPermissions("read"),yield e.handle.getFile()})}static openWrite(e){return s(this,null,function*(){if(!(e.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield e.verityPermissions("readwrite"),yield e.handle.createWritable({keepExistingData:!0})})}static getProperties(e){return s(this,null,function*(){let t=e.handle instanceof FileSystemFileHandle&&(yield e.handle.getFile());return t?{Size:t.size,LastModified:t.lastModified,Type:t.type}:null})}static getItems(e){return s(this,null,function*(){if(e.kind!=="directory"||!e.handle)return new p([]);let t=[];try{for(var r=S(e.handle.entries()),n,o,i;n=!(o=yield r.next()).done;n=!1){let[,a]=o.value;t.push(new d(a))}}catch(o){i=[o]}finally{try{n&&(o=r.return)&&(yield o.call(r))}finally{if(i)throw i[0]}}return new p(t)})}verityPermissions(e){return s(this,null,function*(){if(!!this.handle&&(yield this.handle.queryPermission({mode:e}))!=="granted"&&(yield this.handle.requestPermission({mode:e}))==="denied")throw new Error("Permissions denied")})}static saveBookmark(e){return s(this,null,function*(){if(e.bookmarkId)return e.bookmarkId;if(!e.handle)return null;let t=yield w.connect();try{return yield t.put(m,e.handle,e.generateBookmarkId())}finally{t.close()}})}static deleteBookmark(e){return s(this,null,function*(){if(!e.bookmarkId)return;let t=yield w.connect();try{yield t.delete(m,e.bookmarkId)}finally{t.close()}})}generateBookmarkId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}},p=class{constructor(e){this.items=e}static itemsArray(e){return e.items}};var b=class{static selectFolderDialog(e){return s(this,null,function*(){var n,o;let t={startIn:(o=(n=e==null?void 0:e.wellKnownType)!=null?n:e==null?void 0:e.handle)!=null?o:void 0},r=yield window.showDirectoryPicker(t);return new d(r)})}static openFileDialog(e,t,r,n){return s(this,null,function*(){var a,l;let o={startIn:(l=(a=e==null?void 0:e.wellKnownType)!=null?a:e==null?void 0:e.handle)!=null?l:void 0,multiple:t,excludeAcceptAllOption:n,types:r!=null?r:void 0},i=yield window.showOpenFilePicker(o);return new p(i.map(u=>new d(u)))})}static saveFileDialog(e,t,r,n){return s(this,null,function*(){var a,l;let o={startIn:(l=(a=e==null?void 0:e.wellKnownType)!=null?a:e==null?void 0:e.handle)!=null?l:void 0,suggestedName:t!=null?t:void 0,excludeAcceptAllOption:n,types:r!=null?r:void 0},i=yield window.showSaveFilePicker(o);return new d(i)})}static openBookmark(e){return s(this,null,function*(){let t=yield w.connect();try{let r=yield t.get(m,e);return r&&new d(r,e)}finally{t.close()}})}static createAcceptType(e,t){let r={};return t.forEach(n=>{r[n]=[]}),{description:e,accept:r}}};export{d as StorageItem,p as StorageItems,b as StorageProvider};
//# sourceMappingURL=storage.js.map
